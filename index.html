<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Prototype Game</title>
        <script type='text/javascript' src='phaser.min.js'></script>
        <script type='text/javascript' src='HealthBar.standalone.js'></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    </head>
    <body>

    <script type="text/javascript">
    //START variables
    var game = new Phaser.Game(1600, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

    var ground;

    var badGuyLeftOne;
    var badGuyRightOne;

    var badGuyLeftTwo;
    var badGuyRightTwo;

    var collisionBadGuyLeftOneWithGround;
    var collisionBadGuyRightOneWithGround;
    var collisionBadGuyLeftTwoWithGround;
    var collisionBadGuyRightTwoWithGround;

    var collisionBadGuyLeftOneWithRightTower;
    var collisionBadGuyRightOneWithLeftTower;
    var collisionBadGuyLeftTwoWithRightTower;
    var collisionBadGuyRightTwoWithLeftTower;

    var collisionBadGuyLeftOneWithBadGuyRightOne;
    var collisionBadGuyLeftTwoWithBadGuyRightTwo;

    var fired = false;

    var towerLeft;
    var towerRight;

    var healthBarConfig;
    var towerHealthLeft;
    var towerHealthRight;

    var towerHealthLeftNum = 100;
    var towerHealthRightNum = 100;

    var coin;
    //var showCoin;

    var coinPurse = 150;
    var counter = 0;

    var timer;
	var total = 0;
    //END variables

    //START CoreGameFunctions
    function preload() 
    {
	   	game.load.spritesheet('coin', 'assets/coin.png', 163, 201);
	   	game.load.bitmapFont('carrier_command', 'assets/fonts/bitmapFonts/carrier_command.png', 'assets/fonts/bitmapFonts/carrier_command.xml');
	    game.load.image('sky', 'assets/background.jpg');
	    game.load.image('ground', 'assets/platform.png');
	    game.load.image('star', 'assets/star.png');
	    game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
	    game.load.image('towerRight', 'assets/base1.png');
	    game.load.image('towerLeft', 'assets/base2.png');
	    game.load.spritesheet('baddie', 'assets/baddie.png',32,32);
    }

    function create() 
    {
        game.physics.startSystem(Phaser.Physics.ARCADE);
        level1();
    }

    function update() 
    {
    	userInputs();
    	collisionLogic();
        earnPassiveMoney();
        spawnAI();
    }
    //END CoreGameFunction

    //START BadGuyOneFunctions
    function spawnBadGuyLeftOne()
    {
        var player = game.add.sprite(0,game.world.height-100, 'dude');
        player.enableBody = true;
        game.physics.arcade.enable(player);
        player.animations.add('right', [5, 6, 7, 8], 10, true);
        player.animations.play('right');
        player.body.velocity.x = 150;
        player.body.bounce.y = 0.2;
        player.body.gravity.y = 300;
        player.body.collideWorldBounds = true;
        badGuyLeftOne.add(player);
        coinPurse -= 50;

    }

    function spawnBadGuyRightOne()
    {
    	var player = game.add.sprite(game.world.width-40,game.world.height-100, 'dude');
    	player.enableBody = true ;
    	game.physics.arcade.enable(player);
    	player.animations.add('left', [3, 2, 1, 0], 10, true);
    	player.animations.play( 'left' );
    	player.body.velocity.x = -150;
    	player.body.bounce.y = 0.2;
    	player.body.gravity.y = 300 ;
    	player.body.collideWorldBounds = true ;
    	badGuyRightOne.add(player); 
    }

    function destroyBadGuyLeftOne()
    {
         badGuyLeftOne.getAt(0).destroy();
         earnKillMoney();
    }

    function destroyBadGuyRightOne()
    {
        badGuyRightOne.getAt(0).destroy();
    }
    //END BadGuyOneFunctions

    //START BadGuyTwoFunctions
    function spawnBadGuyLeftTwo()
    {
    	var baddie = game.add.sprite(0,game.world.height-100, 'baddie');
    	baddie.enableBody = true ;
    	game.physics.arcade.enable(baddie);
    	baddie.animations.add('baddieleft', [2, 3], 10, true);
    	baddie.animations.play( 'baddieleft' );
    	baddie.body.velocity.x = 200;
    	baddie.body.bounce.y = 0.2;
    	baddie.body.gravity.y = 300 ;
    	baddie.body.collideWorldBounds = true ;
    	badGuyLeftTwo.add(baddie);
    	coinPurse -= 100;
    }

    function spawnBadGuyRightTwo()
    {
    	var baddie = game.add.sprite(game.world.width-40,game.world.height-100, 'baddie');
    	baddie.enableBody = true ;
    	game.physics.arcade.enable(baddie);
    	baddie.animations.add('baddieright', [1, 0], 10, true);
    	baddie.animations.play( 'baddieright' );
    	baddie.body.velocity.x = -200;
    	baddie.body.bounce.y = 0.2;
    	baddie.body.gravity.y = 300 ;
    	baddie.body.collideWorldBounds = true ;
    	badGuyRightTwo.add(baddie);
    }

    function destroyBadGuyLeftTwo()
    {
    	badGuyLeftTwo.getAt(0).destroy();
    	earnKillMoney();
    }

    function destroyBadGuyRightTwo()
    {
    	badGuyRightTwo.getAt(0).destroy();
    }
    //END BadGuyTwoFunctions

    //START TowerFunctions
    function createTowerLeft(x,y)
    {
        var tower = game.add.sprite(x,y, 'towerLeft');
        tower.enableBody = true ;
        game.physics.arcade.enable(tower);
        tower.scale.setTo(0.5, 1);
        tower.body.immovable = true;
        towersLeft.add(tower);
    }

    function createTowerRight(x,y)
    {
        var tower = game.add.sprite(x,y, 'towerRight');
        tower.enableBody = true ;
        game.physics.arcade.enable(tower);
        tower.body.immovable = true;
        tower.scale.setTo(0.5, 1);
        towersRight.add(tower);
    }
    //END TowerFunctions

    //START Coin Funcitons
    function coin(x,y)
    {
    	coin = game.add.sprite(x,y, 'coin');
    	coin.animations.add('playCoin', [0,1,2], 10, true);
    	coin.animations.play( 'playCoin');
    	coin.scale.setTo(.4,.2);
    }
    
    function earnPassiveMoney()
    {
    	counter = 1/60;
        coinPurse += counter;
        updateText();
    }

    function earnKillMoney()
    {
    	coinPurse += 50;
    	updateText();
    }

    function updateText()
    {
    	showCoin.setText(parseInt(coinPurse));
    }
    //END Coin Functions

    //START HealthbarFunctions
    function createHealthBar(x,y)
    {
    	healthBarConfig = {width: 100, height: 10, x: x, y: y, bg: {color: '#651828'}, bar: {color: '#00ff00'}, animationDuration: 200, flipped: false};
    	var healthbar = new HealthBar(this.game, healthBarConfig);
    	return healthbar;
    }
    //END HealthbarFunctions

    //START Timer (AI) Functions
    function createTimer()
    {
    	timer = game.time.create(false);
    	timer.loop(2000, updateCounter, this);
    	timer.start();
    }

    function updateCounter() 
    {
    	total++;
	}

	function spawnAI()
	{
		if(total == 3)
		{
			spawnBadGuyRightOne();
			total = 0;
		}
	}
	//END Timer (AI) Functions

    //START LevelFunctions
    function level1()
    {
    	game.world.removeAll();
    	var sky = game.add.sprite(0, 0, 'sky');
        sky.scale.setTo(2.5,1);

        createTimer();

        badGuyLeftOne = game.add.group();
        badGuyLeftOne.enableBody = true;
        game.physics.arcade.enable(badGuyLeftOne);

        badGuyRightOne = game.add.group();
        badGuyRightOne.enableBody = true;
        game.physics.arcade.enable(badGuyRightOne);

        badGuyLeftTwo = game.add.group();
        badGuyLeftTwo.enableBody = true;
        game.physics.arcade.enable(badGuyLeftTwo);

        badGuyRightTwo = game.add.group();
        badGuyRightTwo.enableBody = true;
        game.physics.arcade.enable(badGuyRightTwo);

        towersLeft = game.add.group();
        towersLeft.enableBody = true;
        game.physics.arcade.enable(towersLeft);

        towersRight = game.add.group();
        towersRight.enableBody = true;
        game.physics.arcade.enable(towersRight);

        ground = game.add.group();
        ground.enableBody = true;

        var floor = ground.create(0, game.world.height - 30, 'ground');
        floor.scale.setTo(4, 2);
        floor.body.immovable = true;

        createTowerLeft(0,game.world.height-250);
        createTowerRight(game.world.width - 130,game.world.height-250);

        towerHealthLeft = createHealthBar(60,game.world.height-280);
        towerHealthRight = createHealthBar(game.world.width - 55,game.world.height-280);

        coin(0,0);

        showCoin = game.add.text(60,3,coinPurse,{
        	font: "32px Ariel",
        	fill: "#ff0044",
        	align: "center"
        });
    }
    //END LevelFunctions

    //START UserInputFunctions
    function userInputs()
    {
    	window.addEventListener('keydown', function(event)
		{
		    if(!fired) 
		    {
		        fired = true;

				switch (event.key)
		      	{
		      		case "x":
			     		if(coinPurse >= 50)
			     		{
				  			spawnBadGuyLeftOne();
				  		}
						break;

		           	case "y":
		           		spawnBadGuyRightOne();
		        		break;

		        	case "c":
		        		if(coinPurse >= 100)
		        		{
		         			spawnBadGuyLeftTwo();
		         		}
		        		break;

		        	case "b":
		         		spawnBadGuyRightTwo();
		        		break;
		        }
		    }
		});

		window.addEventListener('keyup', function(event)
		{
		    fired = false;
		});
    }
    //END UserInputFunctions

    //START CollisionLogicFunctions
    function collisionLogic()
    {
    	collisionBadGuyLeftOneWithGround = game.physics.arcade.collide(badGuyLeftOne, ground);
        collisionBadGuyRightOneWithGround = game.physics.arcade.collide(badGuyRightOne, ground);
        collisionBadGuyLeftTwoWithGround = game.physics.arcade.collide(badGuyLeftTwo, ground);
        collisionBadGuyRightTwoWithGround = game.physics.arcade.collide(badGuyRightTwo, ground);


        collisionBadGuyLeftOneWithRightTower = game.physics.arcade.collide(badGuyLeftOne,towersRight);
        collisionBadGuyRightOneWithLeftTower = game.physics.arcade.collide(badGuyRightOne,towersLeft);

        collisionBadGuyLeftTwoWithRightTower = game.physics.arcade.collide(badGuyLeftTwo,towersRight);
        collisionBadGuyRightTwoWithLeftTower = game.physics.arcade.collide(badGuyRightTwo,towersLeft);

        collisionBadGuyLeftOneWithBadGuyRightOne = game.physics.arcade.collide(badGuyLeftOne,badGuyRightOne);
        collisionBadGuyLeftTwoWithBadGuyRightTwo = game.physics.arcade.collide(badGuyLeftTwo,badGuyRightTwo);

        if(collisionBadGuyLeftOneWithRightTower)
        {
            destroyBadGuyLeftOne();
            towerHealthRightNum -= 10;
            towerHealthRight.setPercent(towerHealthRightNum);
        }

        if(collisionBadGuyRightOneWithLeftTower)
        {
            destroyBadGuyRightOne();
            towerHealthLeftNum -= 10;
            towerHealthLeft.setPercent(towerHealthLeftNum);
        }

        if(collisionBadGuyLeftTwoWithRightTower)
        {
        	destroyBadGuyLeftTwo();
        	towerHealthRightNum -= 10;
            towerHealthRight.setPercent(towerHealthRightNum);
        }

        if(collisionBadGuyRightTwoWithLeftTower)
        {
        	destroyBadGuyRightTwo();
        	towerHealthLeftNum -= 10;
            towerHealthLeft.setPercent(towerHealthLeftNum);
        }

        if(collisionBadGuyLeftOneWithBadGuyRightOne)
        {
            destroyBadGuyLeftOne();
            destroyBadGuyRightOne();
        }

        if(collisionBadGuyLeftTwoWithBadGuyRightTwo)
        {
        	destroyBadGuyLeftTwo();
            destroyBadGuyRightTwo();
        }

        if(towerHealthLeftNum <= 0 || towerHealthRightNum <= 0)
        {
            game.world.removeAll();
        }
    }
    //END CollisionLogicFunctions
    </script>


    </body>
</html>